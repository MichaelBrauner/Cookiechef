"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),require("regenerator-runtime/runtime");var lodash=require("lodash");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classPrivateFieldGet(e,t){t=t.get(e);if(!t)throw new TypeError("attempted to get private field on non-instance");return t.get?t.get.call(e):t.value}function _classPrivateFieldSet(e,t,i){t=t.get(e);if(!t)throw new TypeError("attempted to set private field on non-instance");if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}return i}function _classPrivateMethodGet(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}var Cookie=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"set",value:function(e,t,i,o,s){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3),document.cookie="".concat(e,"=").concat(t,";expires=").concat(a.toUTCString(),";path=/").concat(null!=s?s:"").concat(o?";samesite="+o:"")}},{key:"remove",value:function(e){var t=this;e instanceof Array?e.forEach(function(e){t.set(e,"",-1)}):this.set(e,"",-1)}},{key:"all",get:function(){var e={};if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),i=0;i<t.length;i++){var o=t[i].split("=");e[o[0].trim()]=o[1].trim()}return e}},{key:"get",value:function(e){return this.all[e]}},{key:"exists",value:function(e){return this.all().hasOwnProperty(e)}},{key:"hasValue",value:function(e,t){return!!this.exists(e)&&this.all()[e]==t}}]),e}(),Encoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"encode",value:function(e){return void 0!==e&&encodeURIComponent(JSON.stringify(e))}},{key:"decode",value:function(e){return void 0!==e&&JSON.parse(decodeURIComponent(e))}}]),e}(),_COOKIE_CHECKED_VALUE=new WeakMap,_COOKIE_DOMAIN=new WeakMap,_SAME_SITE=new WeakMap,_COOKIE_NAME=new WeakMap,_SECURE=new WeakMap,_secureDefault=new WeakMap,_sameSiteDefault=new WeakMap,_cookiesDefault=new WeakMap,_BASIC_STORE=new WeakMap,_$cookieStore=new WeakMap,_$defaultCookies=new WeakMap,_getCookiesOfGroup=new WeakSet,_removeAllCookiesOfGroup=new WeakSet,_createBasicStore=new WeakSet,_getGroup=new WeakSet,_groupCheck=new WeakSet,_cookieCheck=new WeakSet,_getBaseGroupOfCookie=new WeakSet,_getDefaultOfGroup=new WeakSet,_isGroupChecked=new WeakSet,_allCookiesOfGroupUntouched=new WeakSet,_noCookiesOfGroupDenied=new WeakSet,_allCookiesOfGroupApproved=new WeakSet,_initializeDefaults=new WeakSet,_save=new WeakSet,_fetchCookieStore=new WeakSet,_initData=new WeakSet,_vote=new WeakSet,Whisk=function(){function e(){_classCallCheck(this,e),_vote.add(this),_initData.add(this),_fetchCookieStore.add(this),_save.add(this),_initializeDefaults.add(this),_allCookiesOfGroupApproved.add(this),_noCookiesOfGroupDenied.add(this),_allCookiesOfGroupUntouched.add(this),_isGroupChecked.add(this),_getDefaultOfGroup.add(this),_getBaseGroupOfCookie.add(this),_cookieCheck.add(this),_groupCheck.add(this),_getGroup.add(this),_createBasicStore.add(this),_removeAllCookiesOfGroup.add(this),_getCookiesOfGroup.add(this),_COOKIE_CHECKED_VALUE.set(this,{writable:!0,value:1}),_COOKIE_DOMAIN.set(this,{writable:!0,value:void 0}),_SAME_SITE.set(this,{writable:!0,value:void 0}),_COOKIE_NAME.set(this,{writable:!0,value:"cookie-consent"}),_SECURE.set(this,{writable:!0,value:void 0}),_secureDefault.set(this,{writable:!0,value:""}),_sameSiteDefault.set(this,{writable:!0,value:"lax"}),_cookiesDefault.set(this,{writable:!0,value:JSON.stringify([])}),_BASIC_STORE.set(this,{writable:!0,value:{consents_approved:[],consents_denied:[],accepted:!1}}),_$cookieStore.set(this,{writable:!0,value:void 0}),_$defaultCookies.set(this,{writable:!0,value:void 0}),_classPrivateFieldSet(this,_$cookieStore,_classPrivateFieldGet(this,_BASIC_STORE)),this.$cookies=null}return _createClass(e,[{key:"approve",value:function(t){var i=this;_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this),t instanceof Array?(_classPrivateFieldGet(this,_$cookieStore).consents_denied=_classPrivateFieldGet(this,_$cookieStore).consents_denied.filter(function(e){return!t.includes(e)}),t.forEach(function(e){i.isApproved(e)||_classPrivateFieldGet(i,_$cookieStore).consents_approved.push(e)})):(_classPrivateFieldGet(this,_$cookieStore).consents_denied=_classPrivateFieldGet(this,_$cookieStore).consents_denied.filter(function(e){return e!==t}),_classPrivateFieldGet(this,_$cookieStore).consents_approved.push(t)),_classPrivateMethodGet(this,_save,_save2).call(this)}},{key:"deny",value:function(t){var i=this;_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this),t instanceof Array?(_classPrivateFieldGet(this,_$cookieStore).consents_approved=_classPrivateFieldGet(this,_$cookieStore).consents_approved.filter(function(e){return!t.includes(e)}),t.forEach(function(e){i.isDenied(e)||_classPrivateFieldGet(i,_$cookieStore).consents_denied.push(e)})):(_classPrivateFieldGet(this,_$cookieStore).consents_approved=_classPrivateFieldGet(this,_$cookieStore).consents_approved.filter(function(e){return e!==t}),_classPrivateFieldGet(this,_$cookieStore).consents_denied.push(t)),Cookie.remove(t),_classPrivateMethodGet(this,_save,_save2).call(this)}},{key:"approveGroup",value:function(e){_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this),this.approve(_classPrivateMethodGet(this,_getCookiesOfGroup,_getCookiesOfGroup2).call(this,e))}},{key:"denyGroup",value:function(e){_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this),this.deny(_classPrivateMethodGet(this,_getCookiesOfGroup,_getCookiesOfGroup2).call(this,e)),_classPrivateMethodGet(this,_removeAllCookiesOfGroup,_removeAllCookiesOfGroup2).call(this,e)}},{key:"isApproved",value:function(e){return-1!==_classPrivateFieldGet(this,_$cookieStore).consents_approved.indexOf(e)}},{key:"isDenied",value:function(e){return-1!==_classPrivateFieldGet(this,_$cookieStore).consents_denied.indexOf(e)}},{key:"isStoreAccepted",value:function(){return _classPrivateFieldGet(this,_$cookieStore)&&_classPrivateFieldGet(this,_$cookieStore).accepted}},{key:"acceptStore",value:function(){_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this),_classPrivateFieldGet(this,_$cookieStore).accepted=!0,_classPrivateMethodGet(this,_save,_save2).call(this)}},{key:"refreshData",value:function(){return _classPrivateMethodGet(this,_fetchCookieStore,_fetchCookieStore2).call(this),this.$cookies=_classPrivateMethodGet(this,_vote,_vote2).call(this),this.$cookies}},{key:"setCookie",value:function(e,t,i){if(!this.isApproved(e))return!1;Cookie.set(e,t,i)}},{key:"settings",get:function(){return{domain:_classPrivateFieldGet(this,_COOKIE_DOMAIN),samesite:_classPrivateFieldGet(this,_SAME_SITE),secure:_classPrivateFieldGet(this,_SECURE),defaultCookies:_classPrivateFieldGet(this,_$defaultCookies)}}},{key:"init",value:function(e){var t;e?(_classPrivateFieldSet(this,_COOKIE_DOMAIN,null!==(t=e.domain)&&void 0!==t?t:window.location.origin),_classPrivateFieldSet(this,_SAME_SITE,null!==(t=e.sameSite)&&void 0!==t?t:_classPrivateFieldGet(this,_sameSiteDefault)),_classPrivateFieldSet(this,_SECURE,null!==(t=e.secure)&&void 0!==t?t:_classPrivateFieldGet(this,_secureDefault)),e=null!==(e=e.data)&&void 0!==e?e:_classPrivateFieldGet(this,_cookiesDefault),_classPrivateFieldSet(this,_$defaultCookies,JSON.parse(e)),this.$cookies=JSON.parse(e)):_classPrivateMethodGet(this,_initializeDefaults,_initializeDefaults2).call(this),_classPrivateMethodGet(this,_initData,_initData2).call(this)}}]),e}(),_getCookiesOfGroup2=function(t){return this.$cookies.find(function(e){return e.name===t}).cookies.map(function(e){return e.name})},_removeAllCookiesOfGroup2=function(e){Cookie.remove(_classPrivateMethodGet(this,_getCookiesOfGroup,_getCookiesOfGroup2).call(this,e))},_createBasicStore2=function(){return!_classPrivateFieldGet(this,_$cookieStore)&&(_classPrivateFieldSet(this,_$cookieStore,_classPrivateFieldGet(this,_BASIC_STORE)),_classPrivateMethodGet(this,_save,_save2).call(this),_classPrivateFieldGet(this,_$cookieStore))},_getGroup2=function(t){return this.$cookies&&this.$cookies.find(function(e){return e.name===t})},_groupCheck2=function(e){return!(!_classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e)||!_classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e).required)||(!!_classPrivateMethodGet(this,_isGroupChecked,_isGroupChecked2).call(this,e)||!!_classPrivateMethodGet(this,_allCookiesOfGroupUntouched,_allCookiesOfGroupUntouched2).call(this,e)&&_classPrivateMethodGet(this,_getDefaultOfGroup,_getDefaultOfGroup2).call(this,e))},_cookieCheck2=function(t){var e=_classPrivateMethodGet(this,_getBaseGroupOfCookie,_getBaseGroupOfCookie2).call(this,t),i=e&&e.cookies.find(function(e){return e.name===t});return!!e&&(!(!e.required&&!i.required)||(!!_classPrivateMethodGet(this,_isGroupChecked,_isGroupChecked2).call(this,e.name)||!!this.isApproved(t)))},_getBaseGroupOfCookie2=function(t){return this.$cookies&&this.$cookies.find(function(e){return e.cookies.find(function(e){return e.name===t})})},_getDefaultOfGroup2=function(t){return _classPrivateFieldGet(this,_$defaultCookies).find(function(e){return e.name===t}).checked},_isGroupChecked2=function(e){return _classPrivateMethodGet(this,_noCookiesOfGroupDenied,_noCookiesOfGroupDenied2).call(this,e)&&this.isStoreAccepted()||_classPrivateMethodGet(this,_allCookiesOfGroupApproved,_allCookiesOfGroupApproved2).call(this,e)},_allCookiesOfGroupUntouched2=function(e){var t=this;return _classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e).cookies.some(function(e){if(t.isApproved(e.name)&&t.isDenied(e.name))return!1})},_noCookiesOfGroupDenied2=function(e){var t=this;return _classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e)&&!_classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e).cookies.some(function(e){if(t.isDenied(e.name))return!0})},_allCookiesOfGroupApproved2=function(e){var t=this,e=_classPrivateMethodGet(this,_getGroup,_getGroup2).call(this,e);return e&&!lodash.isEmpty(e.cookies)&&e.cookies.every(function(e){return t.isApproved(e.name)})},_initializeDefaults2=function(){_classPrivateFieldSet(this,_COOKIE_DOMAIN,window.location.origin),_classPrivateFieldSet(this,_SAME_SITE,_classPrivateFieldGet(this,_sameSiteDefault)),_classPrivateFieldSet(this,_SECURE,_classPrivateFieldGet(this,_secureDefault)),_classPrivateFieldSet(this,_$defaultCookies,JSON.parse(_classPrivateFieldGet(this,_cookiesDefault))),this.$cookies=JSON.parse(_classPrivateFieldGet(this,_cookiesDefault))},_save2=function(){Cookie.set(_classPrivateFieldGet(this,_COOKIE_NAME),Encoder.encode(_classPrivateFieldGet(this,_$cookieStore)),1,_classPrivateFieldGet(this,_SAME_SITE),_classPrivateFieldGet(this,_SECURE))},_fetchCookieStore2=function(){var e=Encoder.decode(Cookie.get(_classPrivateFieldGet(this,_COOKIE_NAME)));e?_classPrivateFieldSet(this,_$cookieStore,e):_classPrivateMethodGet(this,_createBasicStore,_createBasicStore2).call(this)},_initData2=function(){return _classPrivateMethodGet(this,_fetchCookieStore,_fetchCookieStore2).call(this),this.$cookies=_classPrivateMethodGet(this,_vote,_vote2).call(this),_classPrivateFieldGet(this,_$defaultCookies)},_vote2=function(){var t=this;return _classPrivateFieldGet(this,_$defaultCookies).map(function(e){return e.checked=_classPrivateMethodGet(t,_groupCheck,_groupCheck2).call(t,e.name),e.cookies.map(function(e){e.checked=_classPrivateMethodGet(t,_cookieCheck,_cookieCheck2).call(t,e.name)}),e})};exports.Whisk=Whisk;
